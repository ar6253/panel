<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Profile Edit</title>
<style>
  body{font-family:tahoma;direction:rtl;background:#071018;color:#e6eef8;padding:20px}
  .card{max-width:420px;margin:40px auto;background:rgba(255,255,255,0.03);padding:16px;border-radius:10px}
  label{display:block;margin-top:8px;font-weight:700}
  input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:rgba(0,0,0,0.2);color:#eaf6ff}
  button{margin-top:12px;padding:10px;border-radius:8px;border:0;background:#2b8cff;color:#031625;font-weight:700;cursor:pointer;width:100%}
  .note{font-size:13px;color:#bcd9ff;margin-top:8px}
</style>
</head>
<body>
  <div class="card">
    <h3>تغییرات پروفایل</h3>
    <div class="note">برای وارد کردن آپارات یوزرنیم وارد آپارات خود شوید و نام کانال خود را وارد نمایید.</div>

    <label>آپارات یوزرنیم</label>
    <input id="aparat" placeholder="مثال: example_player">

    <button id="loadBtn">بارگذاری پروفایل</button>

    <div id="formArea" style="display:none">
      <label>نام</label>
      <input id="name">
      <label>شماره همراه</label>
      <input id="phone">
      <label>ادیشن</label>
      <select id="edition"><option value="Java">Java</option><option value="Bedrock">Bedrock</option></select>
      <label>نسخه</label>
      <input id="version">
      <button id="saveBtn">ذخیره تغییرات</button>
      <div id="msg" style="margin-top:8px"></div>
    </div>
  </div>

<script>
const WEB_APP_URL = 'PASTE_YOUR_WEB_APP_URL_HERE'; // <--- جایگزین کن

function showMsg(t, ok){
  const el = document.getElementById('msg');
  el.style.color = ok ? '#9ef0b6' : '#ff9b9b';
  el.textContent = t;
}

document.getElementById('loadBtn').addEventListener('click', async ()=>{
  const u = document.getElementById('aparat').value.trim();
  if(!u){ showMsg('لطفاً یوزرنیم را وارد کنید.', false); return; }
  try{
    const res = await fetch(`${WEB_APP_URL}?username=${encodeURIComponent(u)}`);
    const j = await res.json();
    if(!j.ok){ showMsg(j.error || 'خطا', false); return; }
    // show form
    document.getElementById('formArea').style.display = 'block';
    document.getElementById('name').value = j.profile.name || '';
    document.getElementById('phone').value = j.profile.phone || '';
    document.getElementById('edition').value = j.profile.edition || 'Java';
    document.getElementById('version').value = j.profile.version || '';
    showMsg(j.found ? 'پروفایل بارگذاری شد.' : 'پروفایل جدید آمادهٔ ذخیره‌سازی.', true);
  }catch(err){
    console.error(err);
    showMsg('خطا در ارتباط با سرور.', false);
  }
});

document.getElementById('saveBtn').addEventListener('click', async ()=>{
  const payload = {
    aparat_username: document.getElementById('aparat').value.trim(),
    name: document.getElementById('name').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    edition: document.getElementById('edition').value,
    version: document.getElementById('version').value,
    actor: 'web' // دلخواه
  };
  if(!payload.aparat_username){ showMsg('یوزرنیم خالی است', false); return; }
  try{
    const resp = await fetch(WEB_APP_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const j = await resp.json();
    if(j.ok){
      showMsg('ذخیره شد: ' + j.action, true);
    } else {
      showMsg('خطا: ' + (j.error||'نامشخص'), false);
    }
  }catch(err){
    console.error(err);
    showMsg('خطا در ارتباط با سرور.', false);
  }
});
</script>
</body>
</html>
